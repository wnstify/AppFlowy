# =============================================================================
# AppFlowy Cloud - Security-Hardened Configuration
# =============================================================================
# Copy to .env and fill in real values: cp .env.example .env && chmod 600 .env
# Generate secrets with: openssl rand -hex 24

# -----------------------------------------------------------------------------
# Domain / URL
# -----------------------------------------------------------------------------
FQDN=appflowy.example.com
SCHEME=https
WS_SCHEME=wss

APPFLOWY_BASE_URL=${SCHEME}://${FQDN}
APPFLOWY_WEBSOCKET_BASE_URL=${WS_SCHEME}://${FQDN}/ws/v2
APPFLOWY_WEB_URL=${APPFLOWY_BASE_URL}

# -----------------------------------------------------------------------------
# PostgreSQL
# -----------------------------------------------------------------------------
POSTGRES_USER=appflowy
POSTGRES_PASSWORD=CHANGE_ME_postgres_password
POSTGRES_DB=appflowy
POSTGRES_PORT=5432
POSTGRES_HOST=postgres

APPFLOWY_DATABASE_URL=postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}
APPFLOWY_DATABASE_MAX_CONNECTIONS=40

# GoTrue database URL (requires search_path=auth)
GOTRUE_DATABASE_URL=postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}?search_path=auth

# -----------------------------------------------------------------------------
# Dragonfly (Redis-compatible cache, replaces Redis)
# -----------------------------------------------------------------------------
DRAGONFLY_PASSWORD=CHANGE_ME_dragonfly_password

# Redis-compatible URI for all AppFlowy services
APPFLOWY_REDIS_URI=redis://default:${DRAGONFLY_PASSWORD}@dragonfly:6379

# -----------------------------------------------------------------------------
# MinIO (S3-compatible object storage)
# -----------------------------------------------------------------------------
MINIO_ROOT_USER=minio_admin
MINIO_ROOT_PASSWORD=CHANGE_ME_minio_password

APPFLOWY_S3_USE_MINIO=true
APPFLOWY_S3_MINIO_URL=http://minio:9000
APPFLOWY_S3_CREATE_BUCKET=true
APPFLOWY_S3_ACCESS_KEY=${MINIO_ROOT_USER}
APPFLOWY_S3_SECRET_KEY=${MINIO_ROOT_PASSWORD}
APPFLOWY_S3_BUCKET=appflowy
APPFLOWY_S3_REGION=us-east-1
APPFLOWY_S3_PRESIGNED_URL_ENDPOINT=${APPFLOWY_BASE_URL}/minio-api

# -----------------------------------------------------------------------------
# GoTrue Authentication
# -----------------------------------------------------------------------------
GOTRUE_ADMIN_EMAIL=admin@example.com
GOTRUE_ADMIN_PASSWORD=CHANGE_ME_admin_password

# JWT secret (MUST match across GoTrue and AppFlowy Cloud)
GOTRUE_JWT_SECRET=CHANGE_ME_jwt_secret_use_openssl_rand_hex_32
GOTRUE_JWT_EXP=604800

# Signup disabled by default for security
GOTRUE_DISABLE_SIGNUP=true
GOTRUE_MAILER_AUTOCONFIRM=false
GOTRUE_RATE_LIMIT_EMAIL_SENT=100

# GoTrue external URL (public-facing)
API_EXTERNAL_URL=${APPFLOWY_BASE_URL}/gotrue

# GoTrue internal URL (container-to-container)
APPFLOWY_GOTRUE_BASE_URL=http://gotrue:9999

# -----------------------------------------------------------------------------
# SMTP (Email)
# -----------------------------------------------------------------------------
# GoTrue SMTP (auth emails)
GOTRUE_SMTP_HOST=smtp.example.com
GOTRUE_SMTP_PORT=465
GOTRUE_SMTP_USER=noreply@example.com
GOTRUE_SMTP_PASS=CHANGE_ME_smtp_password
GOTRUE_SMTP_ADMIN_EMAIL=admin@example.com

# AppFlowy Cloud SMTP (app emails)
APPFLOWY_MAILER_SMTP_HOST=smtp.example.com
APPFLOWY_MAILER_SMTP_PORT=465
APPFLOWY_MAILER_SMTP_USERNAME=noreply@example.com
APPFLOWY_MAILER_SMTP_EMAIL=noreply@example.com
APPFLOWY_MAILER_SMTP_PASSWORD=CHANGE_ME_smtp_password
APPFLOWY_MAILER_SMTP_TLS_KIND=wrapper

# -----------------------------------------------------------------------------
# OAuth Providers (optional, uncomment to enable)
# -----------------------------------------------------------------------------
GOTRUE_EXTERNAL_GOOGLE_ENABLED=false
# GOTRUE_EXTERNAL_GOOGLE_CLIENT_ID=
# GOTRUE_EXTERNAL_GOOGLE_SECRET=
# GOTRUE_EXTERNAL_GOOGLE_REDIRECT_URI=${API_EXTERNAL_URL}/callback

GOTRUE_EXTERNAL_GITHUB_ENABLED=false
# GOTRUE_EXTERNAL_GITHUB_CLIENT_ID=
# GOTRUE_EXTERNAL_GITHUB_SECRET=
# GOTRUE_EXTERNAL_GITHUB_REDIRECT_URI=${API_EXTERNAL_URL}/callback

GOTRUE_EXTERNAL_DISCORD_ENABLED=false
# GOTRUE_EXTERNAL_DISCORD_CLIENT_ID=
# GOTRUE_EXTERNAL_DISCORD_SECRET=
# GOTRUE_EXTERNAL_DISCORD_REDIRECT_URI=${API_EXTERNAL_URL}/callback

# -----------------------------------------------------------------------------
# Access Control
# -----------------------------------------------------------------------------
APPFLOWY_ACCESS_CONTROL=true
APPFLOWY_WEBSOCKET_MAILBOX_SIZE=6000

# -----------------------------------------------------------------------------
# Worker
# -----------------------------------------------------------------------------
APPFLOWY_WORKER_DATABASE_URL=${APPFLOWY_DATABASE_URL}
APPFLOWY_WORKER_REDIS_URL=${APPFLOWY_REDIS_URI}
APPFLOWY_WORKER_DATABASE_NAME=${POSTGRES_DB}

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
RUST_LOG=info
